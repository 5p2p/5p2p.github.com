/* 
Justified Gallery
Version: 2.0
Author: Miro Mannino
Author URI: http://miromannino.it

Copyright 2012 Miro Mannino (miro.mannino@gmail.com)

This file is part of Justified Gallery.

This work is licensed under the Creative Commons Attribution 3.0 Unported License. 

To view a copy of this license, visit http://creativecommons.org/licenses/by/3.0/ 
or send a letter to Creative Commons, 444 Castro Street, Suite 900, Mountain View, California, 94041, USA.
*/

(function(d){d.fn.justifiedGallery=function(r){function n(b,i){return'<div class="jg-error '+i+'"style="">'+b+"</div>"}function o(b,i,j){d(b).find(".jg-loading").fadeOut(500,function(){d(this).remove();p(d,b,i,0,j);d.isFunction(j.onComplete)&&j.onComplete.call(this,b)})}function q(b,i,d,c){var a,g=0,h;for(a=0;a<b.length;a++){b[a].nh=Math.ceil(i[b[a].indx].height*((i[b[a].indx].width+d)/i[b[a].indx].width));b[a].nw=i[b[a].indx].width+d;var f=b[a],e=b[a].nw,m=b[a].nh,l=void 0,l=e>m?e:m;f.suffix=100>=
l?c.sizeRangeSuffixes.lt100:240>=l?c.sizeRangeSuffixes.lt240:320>=l?c.sizeRangeSuffixes.lt320:500>=l?c.sizeRangeSuffixes.lt500:640>=l?c.sizeRangeSuffixes.lt640:c.sizeRangeSuffixes.lt1024;b[a].l=g;c.fixedHeight||(0==a?h=b[a].nh:h>b[a].nh&&(h=b[a].nh));g+=b[a].nw+c.margins}c.fixedHeight&&(h=c.rowHeight);d="";for(a=0;a<b.length;a++)g=i[b[a].indx],f=b[a].nh,e=void 0,e='<div class="jg-image" style="left:'+b[a].l+'px">',e+=' <a href="'+g.href+'" ',"undefined"!=typeof g.rel&&(e+='rel="'+g.rel+'"'),"undefined"!=
typeof g.target&&(e+='target="'+g.target+'"'),e+='title="'+g.title+'">',e+='  <img alt="'+g.alt+'" src="'+g.src+b[a].suffix+c.extension+'"',e+='style="width: '+b[a].nw+"px; height: "+f+'px;">',c.captions&&(e+='  <div style="bottom:'+(f-h)+'px;" class="jg-image-label">'+g.alt+"</div>"),e+=" </a></div>",d+=e;return'<div class="jg-row" style="height: '+h+"px; margin-bottom:"+c.margins+'px;">'+d+"</div>"}function p(b,d,f,c,a){var c=[],g,h,k=0,e=b(d).width();for(g=h=0;h<f.length;h++)null!=f[h]&&(k+f[h].width+
a.margins<=e?(k+=f[h].width+a.margins,c[g]=Array(5),c[g].indx=h,g++):(g=Math.ceil((e-k+1)/c.length),b(d).append(q(c,f,g,a)),c=[],c[0]=Array(5),c[0].indx=h,g=1,k=f[h].width+a.margins));g=a.justifyLastRow?Math.ceil((e-k+1)/c.length):0;b(d).append(q(c,f,g,a));a.captions&&(b(d).find(".jg-image").mouseenter(function(a){b(a.currentTarget).find(".jg-image-label").stop();b(a.currentTarget).find(".jg-image-label").fadeTo(500,0.7)}),b(d).find(".jg-image").mouseleave(function(a){b(a.currentTarget).find(".jg-image-label").stop();
b(a.currentTarget).find(".jg-image-label").fadeTo(500,0)}));b(d).find(".jg-resizedImageNotFound").remove();b(d).find(".jg-image img").load(function(){b(this).fadeTo(500,1)}).error(function(){b(d).prepend(n("The image can't be loaded: \""+b(this).attr("src")+'"',"jg-resizedImageNotFound"))}).each(function(){this.complete&&b(this).load()});var m=setInterval(function(){if(e!=b(d).width()){b(d).find(".jg-row").remove();clearInterval(m);p(b,d,f,e,a)}},a.refreshTime)}var f=d.extend({sizeRangeSuffixes:{lt100:"_t",
lt240:"_m",lt320:"_n",lt500:"",lt640:"_z",lt1024:"_b"},rowHeight:120,usedSizeRange:"lt240",margins:1,justifyLastRow:!0,fixedHeight:!1,captions:!0,rel:null,target:null,extension:".jpg",refreshTime:500,onComplete:null},r);return this.each(function(b,i){d(i).addClass("justifiedGallery");var j=0,c=Array(d(i).find("img").length);0!=c.length&&(d(i).append('<div class="jg-loading"><div class="jg-loading-img"></div></div>'),d(i).find("a").each(function(a,b){var h=d(b).find("img");c[a]=Array(5);c[a].src=d(h).attr("src");
c[a].alt=d(h).attr("alt");c[a].href=d(b).attr("href");c[a].title=d(b).attr("title");c[a].rel=null!=f.rel?f.rel:d(b).attr("rel");c[a].target=null!=f.target?f.target:d(b).attr("target");d(b).remove();h=new Image;d(h).load(function(){c[a].width=c[a].height!=f.rowHeight?Math.ceil(this.width/(this.height/f.rowHeight)):this.width;c[a].height=f.rowHeight;c[a].src=c[a].src.slice(0,c[a].src.length-(f.sizeRangeSuffixes[f.usedSizeRange]+f.extension).length);++j==c.length&&o(i,c,f)});d(h).error(function(){d(i).prepend(n("The image can't be loaded: \""+
c[a].src+'"',"jg-usedPrefixImageNotFound"));c[a]=null;++j==c.length&&o(i,c,f)});d(h).attr("src",c[a].src)}))})}})(jQuery);
